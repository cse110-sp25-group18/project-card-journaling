name: Monitor PR Workflows

on:
  workflow_run:
    types: [completed]

jobs:
  notify-on-error:
    if: ${{ github.event.workflow_run.event == 'pull_request' && github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest
    steps:
      - name: ç•™è¨€æé†’ï¼šæ£€æµ‹åˆ°å·¥ä½œæµæ‰§è¡Œå¤±è´¥
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // è·å–æœ¬æ¬¡ workflow_run å¯¹è±¡
            const run = github.event.workflow_run;
            // workflow_run é‡Œä¼šæœ‰ä¸€ä¸ª pull_requests æ•°ç»„ï¼Œè¡¨ç¤ºå½“å‰è¿™æ¬¡è¿è¡Œå…³è”åˆ°å“ªäº› PR
            // é€šå¸¸åªä¼šå…³è”åˆ°ä¸€ä¸ª PRï¼Œæˆ‘ä»¬éå†æ•´ä¸ªæ•°ç»„ä»¥é˜²ä¸‡ä¸€
            for (const pr of run.pull_requests) {
              const prNumber = pr.number;
              // ç•™è¨€å†…å®¹ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦æ”¹æˆæ›´è¯¦ç»†çš„æç¤º
              const body = `ğŸš¨ æ£€æµ‹åˆ° PR #${prNumber} ä¸Šçš„å·¥ä½œæµâ€œ${run.name}â€è¿è¡Œå¤±è´¥ã€‚\n
è¯·ç‚¹å‡» [Actions æ ‡ç­¾](${run.html_url}) æŸ¥çœ‹è¯¦ç»†æ—¥å¿—å¹¶ä¿®å¤é”™è¯¯ã€‚`;
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                body
              });
            }
